<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyber OSINT Search Engine</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-white min-h-screen p-6 font-sans">
  <div class="max-w-xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
    <div class="p-6">
      <h1 class="text-2xl font-bold text-gray-800 mb-4">🔍 IP/DNS Cyber OSINT Search</h1>
      <div class="flex items-center gap-2">
        <input
          id="input"
          type="text"
          placeholder="도메인 또는 IP 입력 (예: naver.com, 8.8.8.8)"
          class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-300"
        />
<button
  onclick="fetchData()"
  class="inline-flex items-center whitespace-nowrap gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium text-sm px-5 py-2.5 rounded-xl shadow-md transition duration-200 ease-in-out"
>
  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6a4 4 0 014 4v1h2a2 2 0 012 2v3H6v-3a2 2 0 012-2h2v-1a4 4 0 014-4z" />
  </svg>
  <span>검색</span>
</button>
      </div>
    </div>
    <div id="result" class="p-6 border-t border-gray-100 space-y-4 text-sm text-gray-800"></div>
  </div>

  <script>
    document.getElementById('input').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') fetchData();
    });

    async function resolveDomain(domain) {
      const res = await axios.get(`https://dns.google/resolve?name=${domain}&type=A`);
      const answers = res.data.Answer || [];
      const ipAnswer = answers.reverse().find(a => a.type === 1);
      if (!ipAnswer) throw new Error("IP 주소를 찾을 수 없습니다.");
      return ipAnswer.data;
    }

    async function fetchData() {
      const input = document.getElementById('input').value.trim();
      const resultEl = document.getElementById('result');
      resultEl.innerHTML = '<div class="text-gray-500">🔄 검색 중...</div>';

      try {
        let ip = input;
        const isDomain = isNaN(Number(input.split('.')[0]));

        if (isDomain) {
          ip = await resolveDomain(input);
        }

        const [shodanRes, ipinfoRes] = await Promise.all([
          axios.get(`https://internetdb.shodan.io/${ip}`),
          axios.get(`https://ipinfo.io/${ip}/json`)
        ]);

        const data = {
          ...shodanRes.data,
          resolvedIp: ip,
          country: ipinfoRes.data.country || '',
          org: ipinfoRes.data.org || '',
        };

        resultEl.innerHTML = `
          <div class="text-sm text-gray-400">@${ip}</div>
          <div class="font-semibold text-lg mb-1">💻 검색 결과</div>

          ${renderSection('호스트네임', data.hostnames)}
          ${renderSection('포트', data.ports, '🔌')}
          ${renderListSection('CPE 목록', data.cpes)}
          ${renderSection('⚠️ 취약점', data.vulns, '', 'bg-red-100 text-red-700')}
          ${renderSection('🏷️ 태그', data.tags, '#')}
          ${renderJaFingerprints(data)}
          ${renderIpinfoSection(data)}
        `;

        if (isDomain) {
          // 서브도메인 정보
          const subBox = document.createElement('div');
          subBox.id = 'subdomains';
          subBox.innerHTML = `
            <div>
              <strong class="block text-gray-600 mt-4">🌐 서브도메인 (certspotter)</strong>
              <div class="text-gray-500 text-xs">🔄 서브도메인 불러오는 중...</div>
            </div>
          `;
          resultEl.appendChild(subBox);
          fetchSubdomains(input);

          // 인증서 정보
          const certBox = document.createElement('div');
          certBox.id = 'crtsh';
          certBox.innerHTML = `
            <div>
              <strong class="block text-gray-600 mt-4">📄 인증서 정보 (crt.sh)</strong>
              <div class="text-gray-500 text-xs">🔄 인증서 정보 불러오는 중...</div>
            </div>
          `;
          resultEl.appendChild(certBox);
          fetchCrtshData(input);
        }

      } catch (e) {
        resultEl.innerHTML = `<div class="text-red-500 font-medium">⚠ ${e.message}</div>`;
      }
    }

    async function fetchCrtshData(domain) {
      try {
        const res = await axios.get(`https://crt.sh/?q=${domain}&output=json`);
        const certs = res.data.slice(0, 10);
        const crtshEl = document.getElementById('crtsh');
        crtshEl.innerHTML = renderCertsSection(certs);
      } catch (err) {
        document.getElementById('crtsh').innerHTML =
          `<div class="text-red-500 text-sm mt-2">⚠ 인증서 정보를 불러올 수 없습니다.</div>`;
      }
    }

    async function fetchSubdomains(domain) {
      try {
        const res = await axios.get(`https://api.certspotter.com/v1/issuances?domain=${domain}&include_subdomains=true&expand=dns_names`);
        const rawDnsNames = res.data.flatMap(entry => entry.dns_names);
        const unique = [...new Set(rawDnsNames)].sort();
        document.getElementById('subdomains').innerHTML = renderSection('발견된 서브도메인', unique, '🔸');
      } catch (err) {
        document.getElementById('subdomains').innerHTML =
          `<div class="text-red-500 text-sm mt-2">⚠ 서브도메인 정보를 불러올 수 없습니다.</div>`;
      }
    }

    function renderSection(title, items = [], prefix = '', badgeClass = 'bg-gray-100 text-gray-700') {
      if (!items || items.length === 0) return '';
      return `
        <div>
          <strong class="block text-gray-600">${title}</strong>
          <div class="flex flex-wrap gap-2 mt-1">
            ${items.map(i => `<span class="px-2 py-1 rounded-full text-xs ${badgeClass}">${prefix} ${i}</span>`).join('')}
          </div>
        </div>
      `;
    }

    function renderListSection(title, items = []) {
      if (!items || items.length === 0) return '';
      return `
        <div>
          <strong class="block text-gray-600">${title}</strong>
          <ul class="list-disc ml-5 mt-1 text-gray-700 text-sm space-y-1">
            ${items.map(i => `<li>${i}</li>`).join('')}
          </ul>
        </div>
      `;
    }

    function renderJaFingerprints(data) {
      const hasAny = data.ja3 || data.ja3s || data.ja4 || data.ja4s;
      if (!hasAny) return '';
      return `
        <div>
          <strong class="block text-gray-600">🔐 TLS 핑거프린트</strong>
          <div class="grid grid-cols-1 gap-1 text-sm text-gray-700 mt-1">
            ${data.ja3 ? `<div><span class="font-semibold">JA3:</span> ${data.ja3}</div>` : ''}
            ${data.ja3s ? `<div><span class="font-semibold">JA3S:</span> ${data.ja3s}</div>` : ''}
            ${data.ja4 ? `<div><span class="font-semibold">JA4:</span> ${data.ja4}</div>` : ''}
            ${data.ja4s ? `<div><span class="font-semibold">JA4S:</span> ${data.ja4s}</div>` : ''}
          </div>
        </div>
      `;
    }

    function renderIpinfoSection(data) {
      if (!data.country && !data.org) return '';
      return `
        <div>
          <strong class="block text-gray-600">📍 네트워크 정보</strong>
          <div class="text-sm text-gray-700 space-y-1 mt-1">
            ${data.country ? `<div><span class="font-semibold">국가:</span> ${data.country}</div>` : ''}
            ${data.org ? `<div><span class="font-semibold">ASN:</span> ${data.org}</div>` : ''}
          </div>
        </div>
      `;
    }

    function renderCertsSection(certs = []) {
      if (!certs || certs.length === 0) {
        return `<div class="text-sm text-gray-500 mt-2">표시할 인증서 정보가 없습니다.</div>`;
      }
      return `
        <div>
          <strong class="block text-gray-600 mt-4">📄 인증서 정보 (crt.sh)</strong>
          <div class="space-y-2 mt-2 text-xs text-gray-800">
            ${certs.map(cert => `
              <div class="border p-2 rounded bg-gray-50">
                <div><strong>📛 Common Name:</strong> ${cert.common_name}</div>
                <div><strong>📥 Name Value:</strong> ${cert.name_value.replace(/\n/g, ', ')}</div>
                <div><strong>🏢 Issuer:</strong> ${cert.issuer_name}</div>
                <div><strong>🕓 등록:</strong> ${cert.entry_timestamp}</div>
                <div><strong>✅ 유효기간:</strong> ${cert.not_before} ~ ${cert.not_after}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
