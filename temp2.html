<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🕵️‍♂️ Cyber OSINT Search</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cyber: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            dark: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              850: '#172033',
              900: '#0f172a',
              950: '#020617',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'pulse-slow': 'pulse 3s infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            glow: {
              '0%': { boxShadow: '0 0 20px rgba(14, 165, 233, 0.3)' },
              '100%': { boxShadow: '0 0 30px rgba(14, 165, 233, 0.5)' },
            }
          }
        }
      }
    }

    function renderSection(title, items = [], prefix = '', customClass = '') {
      if (!items || items.length === 0) return '';
      
      const baseClass = customClass || 'bg-dark-700/30 border-dark-600/30 text-slate-300';
      
      return `
        <div class="bg-dark-900/50 rounded-2xl p-6 border border-dark-700/30">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center">
              <span class="text-sm">${title.split(' ')[0]}</span>
            </div>
            <h3 class="font-bold text-slate-200">${title.split(' ').slice(1).join(' ')}</h3>
          </div>
          <div class="flex flex-wrap gap-3">
            ${items.map(i => `
              <span class="px-4 py-2 rounded-xl border font-medium text-sm ${baseClass} hover:scale-105 transition-transform duration-200">
                ${prefix} ${i}
              </span>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderListSection(title, items = []) {
      if (!items || items.length === 0) return '';
      
      return `
        <div class="bg-dark-900/50 rounded-2xl p-6 border border-dark-700/30 col-span-full">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl flex items-center justify-center">
              <span class="text-sm">${title.split(' ')[0]}</span>
            </div>
            <h3 class="font-bold text-slate-200">${title.split(' ').slice(1).join(' ')}</h3>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto">
            ${items.map(i => `
              <div class="p-3 bg-dark-800/50 rounded-xl border border-dark-700/30 text-sm text-slate-300 font-mono">
                ${i}
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderJaFingerprints(data) {
      if (!data.ja3 && !data.ja3s && !data.ja4 && !data.ja4s) return '';
      
      const fingerprints = [
        { label: 'JA3', value: data.ja3 },
        { label: 'JA3S', value: data.ja3s },
        { label: 'JA4', value: data.ja4 },
        { label: 'JA4S', value: data.ja4s }
      ].filter(fp => fp.value);

      if (fingerprints.length === 0) return '';

      return `
        <div class="bg-dark-900/50 rounded-2xl p-6 border border-dark-700/30">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-8 h-8 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center">
              <span class="text-sm">🔐</span>
            </div>
            <h3 class="font-bold text-slate-200">TLS 핑거프린트</h3>
          </div>
          <div class="space-y-3">
            ${fingerprints.map(fp => `
              <div class="p-4 bg-dark-800/50 rounded-xl border border-dark-700/30">
                <div class="flex items-center justify-between mb-2">
                  <span class="font-bold text-emerald-400">${fp.label}</span>
                  <button onclick="copyToClipboard('${fp.value}')" class="text-xs px-2 py-1 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 rounded-lg transition-colors duration-200">
                    복사
                  </button>
                </div>
                <div class="font-mono text-sm text-slate-300 break-all">${fp.value}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderIpinfoSection(data) {
      const infoItems = [
        { label: '국가', value: data.country, icon: '🌍' },
        { label: '지역', value: data.region, icon: '📍' },
        { label: '도시', value: data.city, icon: '🏙️' },
        { label: '타임존', value: data.timezone, icon: '🕐' },
        { label: 'ASN', value: data.org, icon: '🏢' }
      ].filter(item => item.value);

      if (infoItems.length === 0) return '';

      return `
        <div class="bg-dark-900/50 rounded-2xl p-6 border border-dark-700/30">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-xl flex items-center justify-center">
              <span class="text-sm">📡</span>
            </div>
            <h3 class="font-bold text-slate-200">네트워크 정보</h3>
          </div>
          <div class="space-y-3">
            ${infoItems.map(item => `
              <div class="flex items-center justify-between p-3 bg-dark-800/50 rounded-xl border border-dark-700/30">
                <div class="flex items-center gap-3">
                  <span class="text-lg">${item.icon}</span>
                  <span class="font-medium text-slate-300">${item.label}</span>
                </div>
                <span class="font-bold text-slate-100">${item.value}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderCertsSection(certs = []) {
      if (!certs || certs.length === 0) {
        return `
          <div class="bg-dark-800/60 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-dark-700/50">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-gray-500/20 rounded-2xl flex items-center justify-center">
                <span class="text-xl">📄</span>
              </div>
              <div>
                <h3 class="text-xl font-bold text-slate-300 mb-2">인증서 정보</h3>
                <p class="text-slate-400">표시할 인증서 정보가 없습니다.</p>
              </div>
            </div>
          </div>
        `;
      }

      return `
        <div class="bg-dark-800/60 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-dark-700/50 animate-slide-up">
          <div class="flex items-center gap-4 mb-6">
            <div class="w-12 h-12 bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl flex items-center justify-center">
              <span class="text-xl">📄</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-slate-200">SSL 인증서 정보</h3>
              <p class="text-slate-400">crt.sh 데이터베이스</p>
            </div>
          </div>
          
          <div class="space-y-4">
            ${certs.map(cert => `
              <div class="p-6 bg-dark-900/60 rounded-2xl border border-dark-700/30 hover:border-amber-500/30 transition-colors duration-300">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 text-sm">
                  <div class="space-y-3">
                    <div>
                      <span class="text-amber-400 font-medium">📛 Common Name</span>
                      <div class="mt-1 font-mono text-slate-300 bg-dark-800/50 p-2 rounded-lg">${cert.common_name}</div>
                    </div>
                    <div>
                      <span class="text-amber-400 font-medium">🏢 발급자</span>
                      <div class="mt-1 text-slate-300">${cert.issuer_name}</div>
                    </div>
                  </div>
                  <div class="space-y-3">
                    <div>
                      <span class="text-amber-400 font-medium">🕓 등록일</span>
                      <div class="mt-1 text-slate-300">${cert.entry_timestamp}</div>
                    </div>
                    <div>
                      <span class="text-amber-400 font-medium">✅ 유효기간</span>
                      <div class="mt-1 text-slate-300">${cert.not_before} ~ ${cert.not_after}</div>
                    </div>
                  </div>
                </div>
                <div class="mt-4">
                  <span class="text-amber-400 font-medium">📥 도메인 목록</span>
                  <div class="mt-2 max-h-20 overflow-y-auto">
                    <div class="font-mono text-xs text-slate-400 bg-dark-800/50 p-3 rounded-lg">
                      ${cert.name_value.replace(/\n/g, ', ')}
                    </div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function copyToClipboard(text) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          showToast('클립보드에 복사되었습니다!', 'success');
        }).catch(() => {
          showToast('복사에 실패했습니다.', 'error');
        });
      } else {
        // 폴백 방법
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showToast('클립보드에 복사되었습니다!', 'success');
        } catch (err) {
          showToast('복사에 실패했습니다.', 'error');
        }
        document.body.removeChild(textArea);
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-green-500/90' : 'bg-red-500/90';
      toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-xl z-50 animate-slide-up`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 2000);
    }
  </script>
</body>
</html>
  </script>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sm1ajaw48y");
  </script>
<!-- OpenReplay Tracking Code for my first project -->
<script>
  var initOpts = {
    projectKey: "Wn9H5fNTViYfuPBYa0GB",
    defaultInputMode: 0,
    obscureTextNumbers: false,
    obscureTextEmails: false,
    network: { 
    capturePayload: true,
    failuresOnly: false,
    ignoreHeaders: false
    } 
  };

  // OpenReplay 초기화 함수 정의
  (function (A, s, a, y, e, r) {
    r = window.OpenReplay = [e, r, y, [s - 1, e]];
    s = document.createElement('script');
    s.src = A;
    s.async = !a;
    document.getElementsByTagName('head')[0].appendChild(s);

    r.start = function (v) { r.push([0]) };
    r.stop = function (v) { r.push([1]) };
    r.setUserID = function (id) { r.push([2, id]) };
    r.setUserAnonymousID = function (id) { r.push([3, id]) };
    r.setMetadata = function (k, v) { r.push([4, k, v]) };
    r.event = function (k, p, i) { r.push([5, k, p, i]) };
    r.issue = function (k, p) { r.push([6, k, p]) };
    r.isActive = function () { return false };
    r.getSessionToken = function () { };
  })("//static.openreplay.com/latest/openreplay-assist.js", 1, 0, initOpts, null);

  // 사용자 IP를 가져와 userID로 설정
  async function getUserIP() {
    try {
      const res = await fetch("https://ipinfo.io/json");
      const data = await res.json();
      return data.ip;
    } catch (err) {
      console.error("IP 가져오기 실패:", err);
      return "unknown";
    }
  }

  // 초기화
  async function init() {
    const ip = await getUserIP();

    if (window.OpenReplay && typeof OpenReplay.setUserID === 'function') {
      OpenReplay.setUserID(ip);  // IP를 userID로 설정
    }

    if (window.OpenReplay && typeof OpenReplay.start === 'function') {
      OpenReplay.start();
    }
  }

  init();
</script>

</head>
<body class="bg-gradient-to-br from-dark-950 via-dark-900 to-dark-800 min-h-screen flex font-sans text-slate-100 overflow-x-hidden">

  <!-- 배경 효과 -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -right-40 w-80 h-80 bg-cyber-500/10 rounded-full blur-3xl animate-pulse-slow"></div>
    <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-purple-500/10 rounded-full blur-3xl animate-pulse-slow"></div>
  </div>

  <!-- 좌측: 검색 이력 -->
  <aside class="w-72 bg-dark-850/90 backdrop-blur-xl border-r border-dark-700/50 p-6 hidden lg:block relative z-10">
    <div class="flex items-center gap-3 mb-6">
      <div class="w-8 h-8 bg-gradient-to-r from-cyber-500 to-purple-500 rounded-lg flex items-center justify-center">
        <span class="text-sm">📜</span>
      </div>
      <h2 class="text-lg font-bold text-slate-200">검색 이력</h2>
    </div>
    <div class="border-b border-dark-700/50 mb-4"></div>
    <ul id="historyList" class="space-y-3 text-sm"></ul>
    <button onclick="clearHistory()" class="mt-6 text-xs text-red-400 hover:text-red-300 transition-colors duration-200 hover:underline flex items-center gap-2">
      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2h8a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 3a1 1 0 000 2h4a1 1 0 100-2H7z"></path>
      </svg>
      이력 전체 삭제
    </button>
  </aside>

  <!-- 우측: 메인 콘텐츠 -->
  <main class="flex-1 flex flex-col items-center justify-start pt-8 md:pt-16 px-4 md:px-8 w-full relative z-10">
    <div class="text-center mb-12 animate-fade-in">
      <div class="mb-4">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-cyber-500 to-purple-500 rounded-2xl mb-4 animate-glow">
          <span class="text-3xl">🕵️‍♂️</span>
        </div>
      </div>
      <h1 class="text-5xl md:text-6xl font-black bg-gradient-to-r from-cyber-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-4">
        Cyber OSINT
      </h1>
      <p class="text-lg text-slate-400 max-w-2xl mx-auto leading-relaxed">
        🔍 차세대 IP/도메인 기반 OSINT 검색 플랫폼으로 위협 인텔리전스를 탐지하세요
      </p>
      <div class="flex justify-center mt-6 space-x-4">
        <div class="flex items-center gap-2 text-sm text-slate-500">
          <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
          실시간 위협 분석
        </div>
        <div class="flex items-center gap-2 text-sm text-slate-500">
          <div class="w-2 h-2 bg-cyber-400 rounded-full animate-pulse"></div>
          글로벌 데이터베이스
        </div>
      </div>
    </div>

    <!-- 검색창 -->
    <div class="w-full max-w-2xl mb-8 animate-slide-up">
      <div class="relative group">
        <div class="absolute -inset-1 bg-gradient-to-r from-cyber-500 to-purple-500 rounded-2xl blur opacity-25 group-hover:opacity-40 transition duration-300"></div>
        <div class="relative flex items-center bg-dark-800/80 backdrop-blur-xl rounded-2xl border border-dark-700/50 overflow-hidden shadow-2xl">
          <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          <input
            id="input"
            type="text"
            placeholder="도메인 또는 IP를 입력하세요 (예: google.com, 8.8.8.8)"
            class="w-full pl-12 pr-4 py-4 text-base bg-transparent text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-0"
          />
          <button
            onclick="fetchData()"
            class="bg-gradient-to-r from-cyber-500 to-purple-500 hover:from-cyber-600 hover:to-purple-600 text-white px-8 py-4 text-sm font-bold transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-3 shadow-xl"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
            </svg>
            분석 시작
          </button>
        </div>
      </div>
      
      <!-- 빠른 예시 버튼들 -->
      <div class="flex flex-wrap justify-center gap-2 mt-4">
        <button onclick="quickSearch('google.com')" class="text-xs px-3 py-1 bg-dark-700/50 hover:bg-dark-600/50 text-slate-400 hover:text-slate-300 rounded-full transition-colors duration-200">google.com</button>
        <button onclick="quickSearch('8.8.8.8')" class="text-xs px-3 py-1 bg-dark-700/50 hover:bg-dark-600/50 text-slate-400 hover:text-slate-300 rounded-full transition-colors duration-200">8.8.8.8</button>
        <button onclick="quickSearch('github.com')" class="text-xs px-3 py-1 bg-dark-700/50 hover:bg-dark-600/50 text-slate-400 hover:text-slate-300 rounded-full transition-colors duration-200">github.com</button>
      </div>
    </div>

    <!-- 결과 -->
    <div id="result" class="w-full max-w-5xl space-y-6"></div>

    <!-- 로딩 스피너 -->
    <div id="loadingSpinner" class="hidden fixed inset-0 bg-dark-900/50 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="bg-dark-800/90 backdrop-blur-xl rounded-2xl p-8 flex flex-col items-center gap-4">
        <div class="relative">
          <div class="w-12 h-12 border-4 border-dark-600 rounded-full"></div>
          <div class="absolute top-0 left-0 w-12 h-12 border-4 border-cyber-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
        <p class="text-slate-300 font-medium">데이터를 분석하고 있습니다...</p>
        <p class="text-slate-500 text-sm">여러 보안 데이터베이스를 검색 중</p>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      loadHistory();
      
      // 엔터 키 이벤트 리스너 추가
      const input = document.getElementById('input');
      if (input) {
        input.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            fetchData();
          }
        });
      }
    });

    function quickSearch(query) {
      document.getElementById('input').value = query;
      fetchData();
    }

    function showLoading() {
      const spinner = document.getElementById('loadingSpinner');
      if (spinner) {
        spinner.classList.remove('hidden');
      }
    }

    function hideLoading() {
      const spinner = document.getElementById('loadingSpinner');
      if (spinner) {
        spinner.classList.add('hidden');
      }
    }

    function saveToHistory(query) {
      try {
        let history = JSON.parse(localStorage.getItem('osint_history') || '[]');
        history = history.filter(item => item !== query);
        history.unshift(query);
        if (history.length > 20) history.pop();
        localStorage.setItem('osint_history', JSON.stringify(history));
        loadHistory();
      } catch (e) {
        console.error('History save error:', e);
      }
    }

    function loadHistory() {
      try {
        const historyList = document.getElementById('historyList');
        if (!historyList) return;
        
        const history = JSON.parse(localStorage.getItem('osint_history') || '[]');
        historyList.innerHTML = history.map(item => `
          <li onclick="searchFromHistory('${item}')" class="group cursor-pointer p-3 bg-dark-800/50 hover:bg-dark-700/50 rounded-xl transition-all duration-200 border border-dark-700/30 hover:border-cyber-500/30">
            <div class="flex items-center gap-3">
              <div class="w-2 h-2 bg-cyber-400 rounded-full group-hover:bg-cyber-300"></div>
              <span class="text-slate-300 group-hover:text-cyber-300 font-medium">${item}</span>
            </div>
          </li>
        `).join('');
      } catch (e) {
        console.error('History load error:', e);
      }
    }

    function clearHistory() {
      try {
        localStorage.removeItem('osint_history');
        loadHistory();
      } catch (e) {
        console.error('History clear error:', e);
      }
    }

    function searchFromHistory(query) {
      document.getElementById('input').value = query;
      fetchData();
    }

    async function resolveDomain(domain) {
      const res = await axios.get(`https://dns.google/resolve?name=${domain}&type=A`);
      const answers = res.data.Answer || [];
      const ipAnswer = answers.reverse().find(a => a.type === 1);
      if (!ipAnswer) throw new Error("IP 주소를 찾을 수 없습니다.");
      return ipAnswer.data;
    }

    async function fetchIPQueryRisk(ip) {
      try {
        const res = await axios.get(`https://api.ipquery.io/${ip}?format=json`);
        return res.data.risk || null;
      } catch (e) {
        console.warn("IPQuery 리스크 정보 조회 실패:", e);
        return null;
      }
    }

    async function fetchData() {
      const input = document.getElementById('input');
      const resultEl = document.getElementById('result');
      
      if (!input || !resultEl) {
        console.error('Required elements not found');
        return;
      }

      const inputValue = input.value.trim();

      if (!inputValue) {
        resultEl.innerHTML = `
          <div class="bg-red-500/10 border border-red-500/20 rounded-2xl p-6 backdrop-blur-xl animate-slide-up">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-red-500/20 rounded-xl flex items-center justify-center">
                <svg class="w-5 h-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div>
                <h3 class="font-bold text-red-300">검색어를 입력해주세요</h3>
                <p class="text-red-400/80 text-sm">도메인 또는 IP 주소를 입력하여 분석을 시작하세요.</p>
              </div>
            </div>
          </div>
        `;
        return;
      }

      showLoading();
      
      try {
        saveToHistory(inputValue);
        let ip = inputValue;
        const isDomain = isNaN(Number(inputValue.split('.')[0]));
        if (isDomain) {
          ip = await resolveDomain(inputValue);
        }

        const [shodanRes, ipinfoRes, ipqueryRisk] = await Promise.all([
          axios.get(`https://internetdb.shodan.io/${ip}`),
          axios.get(`https://ipinfo.io/${ip}/json`),
          fetchIPQueryRisk(ip)
        ]);

        const data = {
          ...shodanRes.data,
          resolvedIp: ip,
          country: ipinfoRes.data.country || '',
          org: ipinfoRes.data.org || '',
          city: ipinfoRes.data.city || '',
          region: ipinfoRes.data.region || '',
          timezone: ipinfoRes.data.timezone || '',
          risk: ipqueryRisk
        };

        let subdomainsHtml = '';
        if (isDomain) {
          subdomainsHtml = await fetchSubdomains(inputValue);
        }

        resultEl.innerHTML = `
          <div class="bg-dark-800/60 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-dark-700/50 animate-slide-up">
            <div class="flex items-center justify-between mb-8">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-r from-cyber-500 to-purple-500 rounded-2xl flex items-center justify-center">
                  <span class="text-xl">🎯</span>
                </div>
                <div>
                  <h2 class="text-2xl font-black text-slate-100">${inputValue}</h2>
                  <p class="text-slate-400">분석 결과</p>
                </div>
              </div>
              <div class="flex items-center gap-2 px-4 py-2 bg-green-500/10 border border-green-500/20 rounded-xl">
                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-green-400 text-sm font-medium">분석 완료</span>
              </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="space-y-6">
                ${renderSection('🌐 호스트네임', data.hostnames)}
                ${renderSection('📍 IP 주소', [ip], '', 'bg-cyber-500/10 border-cyber-500/20 text-cyber-300')}
                ${renderRiskSection(data.risk)}
                ${renderSection('🔌 포트', data.ports)}
              </div>
              <div class="space-y-6">
                ${renderSection('⚠️ 취약점', data.vulns, '', 'bg-red-500/10 border-red-500/20 text-red-300')}
                ${renderSection('🏷️ 태그', data.tags, '#')}
                ${renderJaFingerprints(data)}
                ${renderIpinfoSection(data)}
              </div>
            </div>
            
            ${renderListSection('🛠️ CPE 목록', data.cpes)}
            ${subdomainsHtml}
          </div>
        `;

        if (isDomain) {
          const certBox = document.createElement('div');
          certBox.id = 'crtsh';
          certBox.innerHTML = `
            <div class="bg-dark-800/60 backdrop-blur-xl rounded-3xl p-8 shadow-2xl border border-dark-700/50 animate-slide-up">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center">
                  <span class="text-sm">📄</span>
                </div>
                <span class="font-bold text-slate-200">인증서 정보 분석 중...</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-4 h-4 border-2 border-cyber-500 border-t-transparent rounded-full animate-spin"></div>
                <span class="text-slate-400 text-sm">SSL 인증서 데이터베이스 검색 중</span>
              </div>
            </div>
          `;
          resultEl.appendChild(certBox);
          fetchCrtshData(inputValue);
        }

      } catch (e) {
        console.error('Fetch error:', e);
        resultEl.innerHTML = `
          <div class="bg-red-500/10 border border-red-500/20 rounded-3xl p-8 backdrop-blur-xl animate-slide-up">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-red-500/20 rounded-2xl flex items-center justify-center">
                <svg class="w-6 h-6 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-red-300 mb-2">분석 오류</h3>
                <p class="text-red-400">${e.message}</p>
              </div>
            </div>
          </div>
        `;
      } finally {
        hideLoading();
      }
    }

    function renderRiskSection(risk) {
      if (!risk) return '';
      
      const riskItems = [
        { key: 'is_mobile', label: '📱 모바일', value: risk.is_mobile },
        { key: 'is_vpn', label: '🔒 VPN', value: risk.is_vpn },
        { key: 'is_tor', label: '🧅 Tor', value: risk.is_tor },
        { key: 'is_proxy', label: '🔄 프록시', value: risk.is_proxy },
        { key: 'is_datacenter', label: '🏢 데이터센터', value: risk.is_datacenter }
      ];

      const riskScore = risk.risk_score || 0;
      const scoreColor = riskScore === 0 ? 'text-green-400' : 
                        riskScore <= 50 ? 'text-yellow-400' : 'text-red-400';
      const scoreBg = riskScore === 0 ? 'bg-green-500/10 border-green-500/20' : 
                      riskScore <= 50 ? 'bg-yellow-500/10 border-yellow-500/20' : 'bg-red-500/10 border-red-500/20';

      return `
        <div class="bg-dark-900/50 rounded-2xl p-6 border border-dark-700/30">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
              <span class="text-sm">🛡️</span>
            </div>
            <h3 class="font-bold text-slate-200">위험도 분석</h3>
          </div>
          
          <div class="space-y-4">
            <div class="flex items-center justify-between p-4 ${scoreBg} rounded-xl border">
              <span class="font-medium text-slate-300">위험도 점수</span>
              <div class="flex items-center gap-2">
                <span class="text-2xl font-black ${scoreColor}">${riskScore}</span>
                <span class="text-slate-400">/100</span>
              </div>
            </div>
            
            <div class="grid grid-cols-1 gap-2">
              ${riskItems.map(item => {
                const isActive = item.value === true;
                const badgeClass = isActive ? 
                  'bg-red-500/10 border-red-500/30 text-red-300' : 
                  'bg-dark-700/50 border-dark-600/50 text-slate-400';
                const icon = isActive ? '✓' : '✗';
                return `
                  <div class="flex items-center justify-between p-3 ${badgeClass} rounded-xl border">
                    <span class="text-sm font-medium">${item.label}</span>
                    <span class="font-bold">${icon}</span>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </div>
      `;
    }

    async function fetchSubdomains(domain) {
      try {
        const res = await axios.get(`https://api.certspotter.com/v1/issuances?domain=${domain}&include_subdomains=true&expand=dns_names`);
        const rawDnsNames = res.data.flatMap(entry => entry.dns_names);
        const unique = [...new Set(rawDnsNames)].sort();
        return renderSection('🔸 서브도메인', unique.slice(0, 20));
      } catch {
        return `<div class="text-red-400 text-sm p-4 bg-red-500/10 rounded-xl border border-red-500/20">⚠ 서브도메인 정보를 불러올 수 없습니다.</div>`;
      }
    }

    async function fetchCrtshData(domain) {
      try {
        const res = await axios.get(`https://crt.sh/?q=${domain}&output=json`);
        const certs = res.data.slice(0, 5);
        document.getElementById('crtsh').innerHTML = renderCertsSection(certs);
      } catch {
        document.getElementById('crtsh').innerHTML = `
          <div class="bg-red-500/10 border border-red-500/20 rounded-3xl p-8 backdrop-blur-xl">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-red-500/20 rounded-2xl flex items-center justify-center">
                <svg class="w-6 h-6 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-red-300 mb-2">인증서 정보 오류</h3>
                <p class="text-red-400">인증서 정보를 불러올 수 없습니다.</p>
              </div>
            </div>
          </div>
        `;